# analysis/ 目录开发约定

## 开发原则

本目录专注于中文+混合语言的语料分析，遵循"可复现、可扩展、可审计"的设计理念。

### 硬性约束

1. **目录限制**: 仅在 `analysis/` 及其子目录内改动代码
2. **参数集中**: 所有配置参数集中在 `analysis/main.py`，支持 CLI 覆盖
3. **产物统一**: 输出产物统一落入 `analysis/out/`
4. **小步提交**: 采用小步提交与小 PR 的方式推进

### 目录结构

```
analysis/
├── main.py              # 公共入口与参数配置
├── pipeline/            # 核心分析流水线
│   ├── tokenize.py      # 分词与正则化
│   ├── ngrams.py        # N-gram 与搭配抽取
│   ├── stats.py         # 统计指标计算
│   ├── viz.py           # 可视化生成
│   └── report.py        # 报告生成
├── data/                # 数据文件与词典
├── templates/           # 模板文件
├── tests/               # 测试文件
└── out/                 # 输出产物
```

## 开发规范

### 代码质量

- 使用 Python 3.9+ 特性
- 遵循 PEP 8 代码风格
- 添加类型提示
- 编写文档字符串
- 固定随机种子 `SEED=42` 保证复现

### 测试要求

- 使用 pytest 框架
- 测试文件放在 `tests/` 目录
- 测试覆盖率要求 ≥85%（按模块行数计）
- 包含单元测试和集成测试

### 提交规范

使用约定式提交前缀：
- `feat:` - 新功能
- `fix:` - 修复 bug
- `refactor:` - 重构代码
- `perf:` - 性能优化
- `test:` - 测试相关
- `docs:` - 文档更新

### 可视化要求

- 图形导出分辨率 ≥300DPI
- 支持中文字体自动识别
- 提供多种配色方案
- 图表标题和标签完整

### 性能考虑

- 使用生成器/迭代器控制内存
- 支持大语料分块处理
- 优雅处理空或极小语料
- 记录降级处理原因

## 验收标准

每个任务都有明确的验收标准：

1. **功能完整性**: 实现所有要求的功能
2. **测试覆盖**: 单测覆盖率达标
3. **文档完善**: 代码注释和使用说明
4. **性能稳定**: 大语料下稳定运行
5. **结果可复现**: 固定种子后结果一致

## 调试建议

- 使用 `python analysis/main.py --help` 查看所有参数
- 检查 `out/summary.json` 中的配置快照
- 查看日志输出了解处理过程
- 使用小样本数据进行快速测试